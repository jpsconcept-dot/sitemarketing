<!--
        const targetLatitude = 42.07715; // Exemplo: Latitude
        const targetLongitude = -8.46634; // Exemplo: Longitude
        const actionRadius = 100; // Raio de ação em metros (500m neste caso)
                const makeWebhookURL = "https://hook.eu1.make.com/0vbu7dgnt1qrm9gaklel46q56and1cb5"; // Substitua pelo seu Webhook do Make
 -->

<!DOCTYPE html>
<html>
<head>
    <title>Enviar Localização</title>
	<meta charset="utf-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
			display:block;
        }
        input{
            font-size: 18px;
            padding: 10px;
            margin: 10px 0;
            width: 80%;
            max-width: 400px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            font-size: 20px;
            padding: 15px 30px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #status {
            margin-top: 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>Enviar Localização</h1>
    <p>Insira seu email e pressione o botão abaixo para enviar sua localização.</p>
    <input type="email" id="email" placeholder="Digite seu email" required>
    <button onclick="getLocation()">Enviar Localização</button>
    <p id="status">Clique no botão para enviar sua localização.</p>

    <script>
        // Coordenadas do local alvo (latitude e longitude)
        const targetLatitude = 42.07715; // Exemplo: Latitude
        const targetLongitude = -8.46634; // Exemplo: Longitude

        // URL do Webhook do Make
        const makeWebhookURL = "https://hook.eu1.make.com/0vbu7dgnt1qrm9gaklel46q56and1cb5";

        // Função para capturar a localização do usuário
        function getLocation() {
            const email = document.getElementById("email").value;

            if (!email) {
                document.getElementById("status").innerHTML = "Por favor, insira um email válido.";
                return;
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => calculateDistanceAndSend(position, email),
                    showError
                );
            } else {
                document.getElementById("status").innerHTML = "Geolocalização não é suportada pelo navegador.";
            }
        }

        // Função para calcular a distância e enviar os dados para o Webhook do Make
        function calculateDistanceAndSend(position, email) {
            const userLatitude = position.coords.latitude;
            const userLongitude = position.coords.longitude;

            // Calcular a distância entre o usuário e o local alvo
            const distance = calculateDistance(userLatitude, userLongitude, targetLatitude, targetLongitude);

            // Atualizar o status para informar que os dados estão sendo enviados
            document.getElementById("status").innerHTML = `Distância calculada: ${distance.toFixed(2)} km. Enviando dados...`;

            // Dados a serem enviados para o Make
            const data = {
                email: email,
                distance: distance.toFixed(2), // Enviar a distância com 2 casas decimais
                timestamp: new Date().toLocaleString()
            };

            // Enviar os dados para o Webhook do Make
            fetch(makeWebhookURL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (response.ok) {
                    document.getElementById("status").innerHTML = "Dados enviados com sucesso! Aguarde o email.";
                } else {
                    document.getElementById("status").innerHTML = "Erro ao enviar os dados.";
                }
            }).catch(error => {
                document.getElementById("status").innerHTML = "Erro ao conectar ao Make: " + error.message;
            });
        }

        // Função para calcular a distância entre dois pontos geográficos (em quilômetros)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Raio da Terra em quilômetros
            const φ1 = lat1 * Math.PI / 180; // Converter latitude para radianos
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distância em quilômetros
        }

        // Função para tratar erros de geolocalização
        function showError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    document.getElementById("status").innerHTML = "Usuário negou a solicitação de geolocalização.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    document.getElementById("status").innerHTML = "Informações de localização não estão disponíveis.";
                    break;
                case error.TIMEOUT:
                    document.getElementById("status").innerHTML = "A solicitação expirou.";
                    break;
                case error.UNKNOWN_ERROR:
                    document.getElementById("status").innerHTML = "Ocorreu um erro desconhecido.";
                    break;
            }
        }
    </script>
</body>
</html>